/*! KeyTable 2.1.4-dev
 * Â©2009-2016 SpryMedia Ltd - datatables.net/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(b){return a(b,window,document)})}else{if(typeof exports==="object"){module.exports=function(b,c){if(!b){b=window}if(!c||!c.fn.dataTable){c=require("datatables.net")(b,c).$}return a(c,b,b.document)}}else{a(jQuery,window,document)}}}(function(d,b,a,f){var c=d.fn.dataTable;var e=function(j,i){if(!c.versionCheck||!c.versionCheck("1.10.8")){throw"KeyTable requires DataTables 1.10.8 or newer"}this.c=d.extend(true,{},c.defaults.keyTable,e.defaults,i);this.s={dt:new c.Api(j),enable:true,focusDraw:false,waitingForDraw:false};this.dom={};var h=this.s.dt.settings()[0];var g=h.keytable;if(g){return g}h.keytable=this;this._constructor()};d.extend(e.prototype,{blur:function(){this._blur()},enable:function(g){this.s.enable=g},focus:function(h,g){this._focus(this.s.dt.cell(h,g))},focused:function(g){var i=this.s.lastFocus;if(!i){return false}var h=this.s.lastFocus.index();return g.row===h.row&&g.column===h.column},_constructor:function(){this._tabInput();var i=this;var h=this.s.dt;var g=d(h.table().node());if(g.css("position")==="static"){g.css("position","relative")}d(h.table().body()).on("click.keyTable","th, td",function(l){if(i.s.enable===false){return}var k=h.cell(this);if(!k.any()){return}i._focus(k,null,false,l)});d(a).on("keydown.keyTable",function(k){i._key(k)});if(this.c.blurable){d(a).on("click.keyTable",function(k){if(d(k.target).parents(".dataTables_filter").length){i._blur()}if(d(k.target).parents().filter(h.table().container()).length){return}if(d(k.target).parents("div.DTE").length){return}if(d(k.target).parents().filter(".DTFC_Cloned").length){return}i._blur()})}if(this.c.editor){h.on("key.keyTable",function(n,m,l,k,o){i._editor(l,o)})}if(h.settings()[0].oFeatures.bStateSave){h.on("stateSaveParams.keyTable",function(l,k,m){m.keyTable=i.s.lastFocus?i.s.lastFocus.index():null})}h.on("xhr.keyTable",function(l){if(i.s.focusDraw){return}var k=i.s.lastFocus;if(k){i.s.lastFocus=null;h.one("draw",function(){i._focus(k)})}});h.on("destroy.keyTable",function(){h.off(".keyTable");d(h.table().body()).off("click.keyTable","th, td");d(a.body).off("keydown.keyTable").off("click.keyTable")});var j=h.state.loaded();if(j&&j.keyTable){h.one("init",function(){var k=h.cell(j.keyTable);if(k.any()){k.focus()}})}else{if(this.c.focus){h.cell(this.c.focus).focus()}}},_blur:function(){if(!this.s.enable||!this.s.lastFocus){return}var g=this.s.lastFocus;d(g.node()).removeClass(this.c.className);this.s.lastFocus=null;this._updateFixedColumns(g.index().column);this._emitEvent("key-blur",[this.s.dt,g])},_columns:function(){var i=this.s.dt;var g=i.columns(this.c.columns).indexes();var h=[];i.columns(":visible").every(function(j){if(g.indexOf(j)!==-1){h.push(j)}});return h},_editor:function(g,j){var i=this.s.dt;var h=this.c.editor;if(g===16){return}j.stopPropagation();if(g===13){j.preventDefault()}h.inline(this.s.lastFocus.index());d("div.DTE input, div.DTE textarea").select();i.keys.enable(this.c.editorKeys);i.one("key-blur.editor",function(){if(h.displayed()){h.submit()}});h.one("close",function(){i.keys.enable(true);i.off("key-blur.editor")})},_emitEvent:function(h,g){this.s.dt.iterator("table",function(j,k){d(j.nTable).triggerHandler(h,g)})},_focus:function(s,k,i,g){var m=this;var h=this.s.dt;var q=h.page.info();var r=this.s.lastFocus;if(!g){g=null}if(!this.s.enable){return}if(typeof s!=="number"){var l=s.index();k=l.column;s=h.rows({filter:"applied",order:"applied"}).indexes().indexOf(l.row);if(q.serverSide){s+=q.start}}if(q.length!==-1&&(s<q.start||s>=q.start+q.length)){this.s.focusDraw=true;this.s.waitingForDraw=true;h.one("draw",function(){m.s.focusDraw=false;m.s.waitingForDraw=false;m._focus(s,k)}).page(Math.floor(s/q.length)).draw(false);return}if(d.inArray(k,this._columns())===-1){return}if(q.serverSide){s-=q.start}var p=h.cell(":eq("+s+")",k,{search:"applied"});if(r){if(r.node()===p.node()){return}this._blur()}var j=d(p.node());j.addClass(this.c.className);this._updateFixedColumns(k);if(i===f||i===true){this._scroll(d(b),d(a.body),j,"offset");var o=h.table().body().parentNode;if(o!==h.table().header().parentNode){var n=d(o.parentNode);this._scroll(n,n,j,"position")}}this.s.lastFocus=p;this._emitEvent("key-focus",[this.s.dt,p,g||null]);h.state.save()},_key:function(m){if(this.s.waitingForDraw){m.preventDefault();return}var i=this.s.enable;var n=i===true||i==="navigation-only";if(!i){return}if(m.keyCode===0||m.ctrlKey||m.metaKey||m.altKey){return}var o=this.s.lastFocus;if(!o){return}var k=this;var g=this.s.dt;if(this.c.keys&&d.inArray(m.keyCode,this.c.keys)===-1){return}switch(m.keyCode){case 9:this._shift(m,m.shiftKey?"left":"right",true);break;case 27:if(this.s.blurable&&i===true){this._blur()}break;case 33:case 34:if(n){m.preventDefault();var l=g.cells({page:"current"}).nodes().indexOf(o.node());this.s.waitingForDraw=true;g.one("draw",function(){var p=g.cells({page:"current"}).nodes();k._focus(g.cell(l<p.length?p[l]:p[p.length-1]),null,true,m);k.s.waitingForDraw=false}).page(m.keyCode===33?"previous":"next").draw(false)}break;case 35:case 36:if(n){m.preventDefault();var j=g.cells({page:"current"}).indexes();var h=this._columns();this._focus(g.cell(j[m.keyCode===35?j.length-1:h[0]]),null,true,m)}break;case 37:if(n){this._shift(m,"left")}break;case 38:if(n){this._shift(m,"up")}break;case 39:if(n){this._shift(m,"right")}break;case 40:if(n){this._shift(m,"down")}break;default:if(i===true){this._emitEvent("key",[g,m.keyCode,this.s.lastFocus,m])}break}},_scroll:function(g,l,n,p){var k=n[p]();var o=n.outerHeight();var h=n.outerWidth();var i=l.scrollTop();var j=l.scrollLeft();var q=g.height();var m=g.width();if(k.top<i){l.scrollTop(k.top)}if(k.left<j){l.scrollLeft(k.left)}if(k.top+o>i+q&&o<q){l.scrollTop(k.top+o-q)}if(k.left+h>j+m&&h<m){l.scrollLeft(k.left+h-m)}},_shift:function(l,o,m){var k=this;var g=this.s.dt;var p=g.page.info();var s=p.recordsDisplay;var n=this.s.lastFocus;var j=this._columns();if(!n){return}var r=g.rows({filter:"applied",order:"applied"}).indexes().indexOf(n.index().row);if(p.serverSide){r+=p.start}var h=g.columns(j).indexes().indexOf(n.index().column);var q=r,i=j[h];if(o==="right"){if(h>=j.length-1){q++;i=j[0]}else{i=j[h+1]}}else{if(o==="left"){if(h===0){q--;i=j[j.length-1]}else{i=j[h-1]}}else{if(o==="up"){q--}else{if(o==="down"){q++}}}}if(q>=0&&q<s&&d.inArray(i,j)!==-1){l.preventDefault();this._focus(q,i,true,l)}else{if(!m||!this.c.blurable){l.preventDefault()}else{this._blur()}}},_tabInput:function(){var i=this;var h=this.s.dt;var g=this.c.tabIndex!==null?this.c.tabIndex:h.settings()[0].iTabIndex;if(g==-1){return}var j=d('<div><input type="text" tabindex="'+g+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(h.table().node());j.children().on("focus",function(k){i._focus(h.cell(":eq(0)","0:visible",{page:"current"}),null,true,k)})},_updateFixedColumns:function(i){var j=this.s.dt;var h=j.settings()[0];if(h._oFixedColumns){var k=h._oFixedColumns.s.iLeftColumns;var g=h.aoColumns.length-h._oFixedColumns.s.iRightColumns;if(i<k||i>g){j.fixedColumns().update()}}}});e.defaults={blurable:true,className:"focus",columns:"",editor:null,editorKeys:"navigation-only",focus:null,keys:null,tabIndex:null};e.version="2.1.4-dev";d.fn.dataTable.KeyTable=e;d.fn.DataTable.KeyTable=e;c.Api.register("cell.blur()",function(){return this.iterator("table",function(g){if(g.keytable){g.keytable.blur()}})});c.Api.register("cell().focus()",function(){return this.iterator("cell",function(g,i,h){if(g.keytable){g.keytable.focus(i,h)}})});c.Api.register("keys.disable()",function(){return this.iterator("table",function(g){if(g.keytable){g.keytable.enable(false)}})});c.Api.register("keys.enable()",function(g){return this.iterator("table",function(h){if(h.keytable){h.keytable.enable(g===f?true:g)}})});c.ext.selector.cell.push(function(l,m,j){var n=m.focused;var o=l.keytable;var h=[];if(!o||n===f){return j}for(var k=0,g=j.length;k<g;k++){if((n===true&&o.focused(j[k]))||(n===false&&!o.focused(j[k]))){h.push(j[k])}}return h});d(a).on("preInit.dt.dtk",function(k,h,g){if(k.namespace!=="dt"){return}var l=h.oInit.keys;var j=c.defaults.keys;if(l||j){var i=d.extend({},j,l);if(l!==false){new e(h,i)}}});return e}));